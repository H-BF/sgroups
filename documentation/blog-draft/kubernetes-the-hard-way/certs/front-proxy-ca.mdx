import { FancyboxDiagram }  from '@site/src/components/commonBlocks/FancyboxDiagram'
import TabItem              from '@theme/TabItem'
import Tabs                 from '@theme/Tabs'

<details>
<summary>Front Proxy CA</summary>

### Переменные окружения сертификатов

```bash
mkdir -p ${BASE_K8S_PATH}/pki/

export FRONT_PROXY_CA_KEY_PATH="${BASE_K8S_PATH}/pki/front-proxy-ca.key"
export FRONT_PROXY_CA_CRT_PATH="${BASE_K8S_PATH}/pki/front-proxy-ca.crt"
export FRONT_PROXY_CA_CSR_PATH="${BASE_K8S_PATH}/openssl/front-proxy-ca.conf"
export FRONT_PROXY_CA_KEY_SIZE=2048
```

### Инструкция создания сертификатов

:::note
Для удобства добавил блок расширения, что бы в перспективе отобразить инструкции сертификатов для `cfssl`
:::

<Tabs 
    defaultValue='openssl'
    values={[
        { label: "openssl", value: "openssl" },
    ]}>
    <TabItem value='openssl'>

      ```bash
      mkdir -p ${BASE_K8S_PATH}/openssl
      ```

      #### Конфигурация `openssl` CA

      ```bash
      cat <<EOF > ${FRONT_PROXY_CA_CSR_PATH}
      [req]
      distinguished_name = req_distinguished_name
      x509_extensions    = v3_ca
      prompt             = no

      [req_distinguished_name]
      CN = "front-proxy-ca"

      [v3_ca]
      keyUsage = critical, keyCertSign, keyEncipherment, digitalSignature
      basicConstraints = critical,CA:TRUE
      EOF
      ```

      #### Генерация приватного ключа `CA` сертификата

      ```bash
      openssl genrsa \
        -out "${FRONT_PROXY_CA_KEY_PATH}" ${FRONT_PROXY_CA_KEY_SIZE}
      ```

      #### Генерация публичного ключа `CA` сертификата

      ```bash
      openssl req \
        -x509 \
        -new \
        -nodes \
        -key "${FRONT_PROXY_CA_KEY_PATH}" \
        -sha256 \
        -days 3650 \
        -out "${FRONT_PROXY_CA_CRT_PATH}" \
        -config "${FRONT_PROXY_CA_CSR_PATH}"
      ```

    </TabItem>

</Tabs>

</details>

